import express = require("express");
import loudRejection = require("loud-rejection");
import splashScreen = require("asciiart-logo");

import { cfg } from "./config/app-config";
import { setupUI } from "./setup-ui";
import { setupMW, setupErrorHandlingMW } from "./setup-mw";
import { createServer } from "./create-server";

const app = express();

loudRejection();
setupMW(app);
setupUI(app);
setupErrorHandlingMW(app);

const server = createServer(app);

server.listen({
    port: cfg.apiServer.port,
},
() => {
    console.log(splashScreen(cfg.about).render());
    const serverAddress = server.address();
    const address = serverAddress.address.split(":").join("").length ? serverAddress.address : "localhost";
    const host = address + ":" + serverAddress.port;
    console.info(`<%- title %> server "<%- name %>" is running on ${host}.`);
    console.info("... listening");
});
